var dkJSULightbox=new Class({initialize:function(a){this.opt=a,a.triggers&&(this.createLightBox(),this.setEvents())},createLightBox:function(){this.opt;this.lightbox=new Element(".lightbox"),this.lightboxfilter=new Element(".lightbox-filter"),this.lightbox.adopt(this.lightboxfilter),this.lightboxcontent=new Element(".lightbox-content"),this.lightbox.adopt(this.lightboxcontent),this.closeLightbox(),$(document.body).adopt(this.lightbox)},setEvents:function(){var a=this,b=this.opt;b.triggers.addEvent("click",function(b){b.preventDefault(),a.openLink($(this))}),this.lightboxfilter.addEvent("click",function(b){b.preventDefault(),a.closeLightbox()}),this.lightbox.addEvent("click:relay(.btn-close-lightbox)",function(b){b.preventDefault(),a.closeLightbox()}),$(window).addEvent("keydown",function(b){b.key&&"esc"==b.key&&a.closeLightbox()})},openLink:function(a){var b=document.createElement("a");b.href=a.href;var c=b.pathname.split(".").pop().toLowerCase(),d=b.pathname.replace("/",""),e=this.getUrlParams(b.search);return"jpg"==c?void this.openImage(a.href):"youtube.com"!=b.hostname&&"www.youtube.com"!=b.hostname||!e.v?"vimeo.com"!=b.hostname&&"www.vimeo.com"!=b.hostname||!this.isNumber(d)?b.hostname!=window.location.hostname?void this.openExternalURL(a.href):void this.openRelativeURL(a.href):void this.openVideo(d,"vimeo"):void this.openVideo(e.v,"youtube")},openExternalURL:function(a){this.loadContentInLightbox('<iframe src="'+a+'" />',"iframe"),this.openLightbox()},openRelativeURL:function(a){{var b=this;new Request({method:"get",url:a,data:{ajax:"1"},onComplete:function(a){b.loadContentInLightbox(a,"content"),b.openLightbox()}}).send()}},openMessage:function(a){this.loadContentInLightbox("<p>"+a+"</p>","message"),this.openLightbox()},openImage:function(a){var b=this,c=new Image;c.src=a;new Asset.image(a,{onLoad:function(){var d=c.width,e=c.height,f=d/e,g=window.getWidth()-10,h=window.getHeight()-10,i=g/h;i>f?e>h&&(e=h,d=f*e):d>g&&(d=g,e=d/f),b.loadContentInLightbox('<img style="display:block;" width="'+d+'" height="'+e+'" src="'+a+'" alt="" />',"image",{width:d,height:e,"margin-left":0-d/2,"margin-top":0-e/2}),b.openLightbox()}})},openVideo:function(a,b){var c="";switch(b){case"youtube":c='<iframe width="580" height="377" src="http://www.youtube.com/embed/'+a+'" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":c='<iframe src="http://player.vimeo.com/video/'+a+'?autoplay=1" width="580" height="326" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}this.loadContentInLightbox(c,b),this.openLightbox()},loadContentInLightbox:function(a,b,c){c=c||{},this.lightboxcontent.set("style",""),this.lightboxcontent.setStyles(c),this.lightbox.set("data-lb",b),this.lightboxcontent.set("html",a)},openLightbox:function(){this.lightbox.removeClass("lb-is-hidden")},closeLightbox:function(){var a=this.lightbox,b=a.get("data-lb");-1!==["vimeo","youtube"].indexOf(b)&&this.loadContentInLightbox("",b),this.lightbox.addClass("lb-is-hidden")},getUrlParams:function(a){var b={};a=a.slice(1).split("&");for(var c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=unescape(d[1])}return b},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}});