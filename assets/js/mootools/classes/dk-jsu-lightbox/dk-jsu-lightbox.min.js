var dkJSULightbox=new Class({defaultSettings:{triggers:!1,callback:function(){}},initialize:function(a){return window.hasDkJSULightbox?!1:(window.hasDkJSULightbox=!0,this.getSettings(a),void(a.triggers&&(this.createLightBox(),this.setEvents())))},getSettings:function(a){"object"!=typeof a&&(a={}),this.settings=Object.merge({},this.defaultSettings,a)},createLightBox:function(){this.lightbox=new Element(".lightbox"),this.lightboxfilter=new Element(".lightbox-filter"),this.lightbox.adopt(this.lightboxfilter),this.lightboxcontent=new Element(".lightbox-content"),this.lightbox.adopt(this.lightboxcontent),this.closeLightbox(),$(document.body).adopt(this.lightbox)},setEvents:function(){var a=this,b=this.settings;b.triggers.addEvent("click",function(b){b.preventDefault(),a.openLink($(this))}),this.lightboxfilter.addEvent("click",function(b){b.preventDefault(),a.closeLightbox()}),this.lightbox.addEvent("click:relay(.btn-close-lightbox)",function(b){b.preventDefault(),a.closeLightbox()}),$(window).addEvent("keydown",function(b){if(b.key)switch(b.key){case"esc":a.closeLightbox();break;case"right":a.goToImage("next");break;case"left":a.goToImage("prev")}})},openLink:function(a){var b=document.createElement("a");b.href=a.href;var c=b.pathname.split(".").pop().toLowerCase(),d=b.pathname.replace("/",""),e=this.getUrlParams(b.search);return"jpg"==c?void this.openImage(a.href,a):"youtube.com"!=b.hostname&&"www.youtube.com"!=b.hostname||!e.v?"vimeo.com"!=b.hostname&&"www.vimeo.com"!=b.hostname||!this.isNumber(d)?b.hostname!=window.location.hostname?void this.openExternalURL(a.href):void this.openRelativeURL(a.href):void this.openVideo(d,"vimeo"):void this.openVideo(e.v,"youtube")},openExternalURL:function(a){this.loadContentInLightbox('<iframe src="'+a+'" />',"iframe"),this.openLightbox()},openRelativeURL:function(a){{var b=this;new Request({method:"get",url:a,data:{ajax:"1"},onComplete:function(a){b.loadContentInLightbox(a,"content"),b.openLightbox()}}).send()}},openMessage:function(a){this.loadContentInLightbox("<p>"+a+"</p>","message"),this.openLightbox()},openImage:function(a,b){var c=this;if(c.imagesGallery="",c.currentImage="",$(b).get("data-lightboxname")&&!c.imagesGallery){var d='[data-lightboxname="'+$(b).get("data-lightboxname")+'"]';c.imagesGallery=$$(d),c.imagesGallery.each(function(b,d){b.href==a&&(c.currentImage=d)})}var e=new Image;e.src=a,new Asset.image(a,{onLoad:function(){var b=e.width,d=e.height;c.loadContentInLightbox('<div class="icn-imgclose btn-close-lightbox">&times;</div><img width="'+b+'" height="'+d+'" src="'+a+'" alt="" />',"image",{"text-align":"center",width:b,height:d}),c.openLightbox()}})},goToImage:function(a){var b=this;if(!b.imagesGallery)return!1;var c=b.imagesGallery.length;"next"==a&&(a=b.currentImage+1),"prev"==a&&(a=b.currentImage-1),0>a&&(a=c-1),a>=c&&(a=0),b.openLink(b.imagesGallery[a])},openVideo:function(a,b){var c="";switch(b){case"youtube":c='<iframe width="580" height="377" src="http://www.youtube.com/embed/'+a+'" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":c='<iframe src="http://player.vimeo.com/video/'+a+'?autoplay=1" width="580" height="326" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}this.loadContentInLightbox(c,b),this.openLightbox()},loadContentInLightbox:function(a,b,c){c=c||{},this.lightboxcontent.set("style",""),this.lightboxcontent.setStyles(c),this.lightbox.set("data-lb",b),this.lightboxcontent.set("html",a)},openLightbox:function(){this.lightbox.removeClass("lb-is-hidden"),"function"==typeof this.settings.callback&&this.settings.callback()},closeLightbox:function(){var a=this.lightbox,b=a.get("data-lb");-1!==["vimeo","youtube"].indexOf(b)&&this.loadContentInLightbox("",b),this.lightbox.addClass("lb-is-hidden"),this.imagesGallery=""},getUrlParams:function(a){var b={};a=a.slice(1).split("&");for(var c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=unescape(d[1])}return b},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}});